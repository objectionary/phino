# SPDX-FileCopyrightText: Copyright (c) 2025 Objectionary.com
# SPDX-License-Identifier: MIT
---
# @todo #85:60min Simplify Rcopy rule. Right now this rule is quite verbose.
#  It captures a lot objects around its targets. It's done in order to have
#  scope for contextualization of ğ‘’2 right here right away. So it's a hack.
#  The origin Rcopy rule looks like this
#  pattern: âŸ¦ ğµ1, ğœ1 â†¦ âˆ…, ğµ3 âŸ§(ğœ1 â†¦ ğ‘’1)
#  result: âŸ¦ ğµ1, ğœ1 â†¦ ğ‘’2, ğµ3 âŸ§
#  where ğ‘’2 is an expression contextualized with ğ‘’1 and some scope S.
#  But with such pattern we don't have this scope, we don't see it.
#  It should be calculated somehow. In general this scope is nearest
#  outer formation. So we need to create a way to calculate it and
#  rewrite this rule.
name: COPY
pattern: âŸ¦ ğµ1, ğœ1 â†¦ âŸ¦ ğµ2, ğœ2 â†¦ âˆ…, ğµ3 âŸ§(ğœ2 â†¦ ğ‘’1) * !t, ğµ4 âŸ§
result: âŸ¦ ğµ1, ğœ1 â†¦ âŸ¦ ğµ2, ğœ2 â†¦ ğ‘’2, ğµ3 âŸ§ * !t, ğµ4 âŸ§
when:
  xi: ğ‘’1
where:
  - meta: ğ‘’2
    function: contextualize
    args:
      - ğ‘’1
      - âŸ¦ ğµ1, ğœ1 â†¦ âŸ¦ ğµ2, ğœ2 â†¦ âˆ…, ğµ3 âŸ§(ğœ2 â†¦ ğ‘’1) * !t, ğµ4 âŸ§
