# SPDX-FileCopyrightText: Copyright (c) 2025 Objectionary.com
# SPDX-License-Identifier: MIT
---
# yamllint disable rule:line-length
name: haddock
'on':
  push:
    branches:
      - master
permissions:
  contents: write
jobs:
  haddock:
    env:
      GHC_VERSION: 9.6.7
    runs-on: macos-15
    steps:
      - uses: actions/checkout@v6
      - uses: actions/cache@v4
        with:
          path: |
            ~/.ghcup
            ~/.cabal/packages
            ~/.cabal/store
            ~/.ghc
            dist-newstyle
          key: ${{ runner.os }}-haddock-${{ hashFiles('**/*.cabal') }}-${{ hashFiles('cabal.project', 'cabal.project.freeze') }}
          restore-keys: |
            ${{ runner.os }}-haddock-
      - uses: haskell-actions/setup@v2.8.2
        with:
          ghc-version: ${{ env.GHC_VERSION }}
          cabal-version: '3.12.1.0'
      - run: cabal update
      - run: cabal haddock --haddock-hyperlink-source
      - uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: dist-newstyle/build/aarch64-osx/ghc-${{ env.GHC_VERSION }}/phino-0.0.0.0/doc/html/phino
          branch: gh-pages
